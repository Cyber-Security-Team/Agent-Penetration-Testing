# 250821 README

这周因为想要搜索更多的内容，单次request会超出Token限制，所以需要分批向LLM发起**batch request**，再加上使用OCR抄录图片里的文字（因为有些教程里的payload并没有单独被摘出来，而是以截图的形式+讲解展示的），所以用来Claude和GPT的API，发现不同的大模型返回的search summary差别很大 +搜索结果不鲁棒。存在的问题包括：

1. 首次发起的request请求，使用的关键词和相关参数均符合prompt要求（单次搜索+指定关键词）
2. 在接下来batch request中，会多次调用Tavily MCP（我的搜索工具），"function_call"使用的搜索关键词也被改变了
3. 我在工具的配置里限制了黑白名单，但是返回的搜索结果中还是出现了限制条件以外的域名，由于日志太长，看着太费眼睛，还没有发现是哪里出了问题
4. 不同LLM返回的summary输出虽然结构符合要求（即一级标题符合要求），但是会发散细节（如二级、三级标签自由发挥），所以我还需要进一步优化prompt里的输出结构限制

```markdown
# [Topic]
## Search Keywords
[search keywords]
## CVE Exploitation Tutorial
[exploitation guide here]

## Reference Links
- [link1]
- [link2]
- ...
## Appendix
[Tavily search result]
```

- Deepseek

  ```powershell
  {"parts":[{"text":"The *CVE_NAME* is CVE-2016-3088 "}],"role":"user"}
  {"parts":[{"text":"I'll search for exploitation tutorials and information about CVE-2016-3088. Let me start by searching for relevant content."},{"function_call":{"id":"call_0_e6bb1176-c03d-471e-abe6-0a382aa8dafa","args":{"query":"CVE-2016-3088 README exploitation example tutorial","search_depth":"advanced","include_images":true},"name":"tavily_search"}}],"role":"model"}
  {"parts":[{"function_response":{"id":"call_0_e6bb1176-c03d-471e-abe6-0a382aa8dafa","name":"tavily_search","response":{"query":"CVE-2016-3088 README exploitation example tutorial","follow_up_questions":null,"answer":null,"images":[{"url":"https://www.exploit-db.com/screenshots/idlt22000/screen-shot-2012-09-25-at-21324-pm.png","description":"The image shows a terminal window where a user conducts network reconnaissance and exploitation testing using Python scripts and ping commands, related to the CVE-2016-3088 vulnerability."}],"results":[{"title":"Common Vulnerabilities and Exposures - Wikipedia","url":"https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures"
  ……
  }

  ```
- Claude

```powershell
{"parts":[{"text":"I'll help you search for and extract a CVE exploitation tutorial for CVE-2021-41773. Let me start by searching for relevant information."},
{"function_call":{"id":"toolu_01EUTz2NwttUrzJXK8MGCG8d","args":{"query":"CVE-2021-41773 README exploitation example tutorial","search_depth":"advanced","include_images":true},"name":"tavily_search"}}],"role":"model"}
{"parts":[{"function_response":{"id":"toolu_01EUTz2NwttUrzJXK8MGCG8d","name":"tavily_search","response":{"query":"CVE-2021-41773 README exploitation example tutorial","follow_up_questions":null,"answer":null,"images":[……],"results":[{"title":"GitHub vulhub/httpd/CVE-2021-41773/README.zh-cn.md at master · vulhub/vulhub","url":"https://github.com/vulhub/vulhub/blob/master/httpd/CVE-2021-41773/README.zh-cn.md","content":"{……}

{"parts":[{"text":"Let me search for more specific exploitation details and examples."},{"function_call":{"id":"toolu_01RayFihBr9hJYX1hExd7jdp","args":{"query":"CVE-2021-41773 Apache HTTP Server path traversal exploit payload","search_depth":"advanced","include_images":true},"name":"tavily_search"}}],"role":"model"}
{"parts":[{"function_response":{"id":"toolu_01RayFihBr9hJYX1hExd7jdp","name":"tavily_search","response":{"query":"CVE-2021-41773 Apache HTTP Server path traversal exploit payload","follow_up_questions":null,"answer":null,"images":[],"results":[{"url":"https://github.com/vulhub/vulhub/blob/master/httpd/CVE-2021-41773/README.md",……}

{"parts":[{"text":"Let me search for more detailed exploitation techniques and methods."},{"function_call":{"id":"toolu_01HRumiaM6oHfrNb7XmgafQi","args":{"query":"CVE-2021-41773 HTTP request payload path traversal attack example","search_depth":"advanced","include_images":true},"name":"tavily_search"}}],"role":"model"}


{"function_call":{"id":"toolu_01NASN7DYGTosgKzFLsgqBNz","args":{"topic":"CVE-2021-41773","content":……},"name":"write_report"}}],"role":"model"}
{"parts":[{"function_response":{"id":"toolu_01NASN7DYGTosgKzFLsgqBNz","name":"write_report","response":{"status":"success","report":"The report has been written as a markdown file with \"CVE-2021-41773.md\""}}}],"role":"user"}

```

- ChatGPT

```powershell
{"parts":[{"text":"The *CVE_NAME* is CVE-2016-3088 "}],"role":"user"}
{"parts":[{"function_call":{"id":"call_9HD4DXqX4EljTIgxDEjpBUov","args":{"query":"CVE-2016-3088 exploitation tutorial ActiveMQ Fileserver arbitrary file upload","search_depth":"advanced","include_images":false},"name":"tavily_search"}}],"role":"model"}
{"parts":[{"function_response":{"id":"call_9HD4DXqX4EljTIgxDEjpBUov","name":"tavily_search","response":{"query":"CVE-2016-3088 exploitation tutorial ActiveMQ Fileserver arbitrary file upload","follow_up_questions":null,"answer":null,"images":[^],"results":[{"url":"https://www.exploit-db.com/exploits/42283"……}


{"parts":[{"function_call":{"id":"call_mswHM3zvGInkERluGmqXNkD3","args":{"query":"CVE-2016-3088 Apache ActiveMQ Fileserver HTTP PUT MOVE curl exploit","search_depth":"advanced"},"name":"tavily_search"}}],"role":"model"}
{"parts":[{"function_response":{"id":"call_mswHM3zvGInkERluGmqXNkD3","name":"tavily_search","response":{"query":"CVE-2016-3088 Apache ActiveMQ Fileserver HTTP PUT MOVE curl exploit","follow_up_questions":null,"answer":null,"images":[……],"results":[{"url":"https://www.exploit-db.com/exploits/42283","title":……}


{"parts":[{"function_call":{"id":"call_w6Tou1Pe7pRLRcnrLqq2qLh2","args":{"query":"CVE-2016-3088 Apache ActiveMQ fileserver advisory announcement","search_depth":"basic","include_images":false},"name":"tavily_search"}}],"role":"model"}
{"parts":[{"function_response":{"id":"call_w6Tou1Pe7pRLRcnrLqq2qLh2","name":"tavily_search","response":{"query":"CVE-2016-3088 Apache ActiveMQ fileserver advisory announcement","follow_up_questions":null,"answer":null,"images":[……],"results":[……}
{"parts":[{"function_response":{"id":"call_g3sHGWm74vX9Ex1apx9vDqW4","name":"tavily_search","response":{"query":"CVE-2016-3088 curl exploit PoC ActiveMQ fileserver PUT MOVE curl -metasploit","follow_up_questions":null,"answer":null,"images":[……],"results":[……}

{"parts":[{"function_call":{"id":"call_0C7hGewo5eenf7In4t0piBPd","args":{"topic":"CVE-2016-3088","content":^},"name":"write_report"}}],"role":"model"}

{"parts":[{"function_response":{"id":"call_0C7hGewo5eenf7In4t0piBPd","name":"write_report","response":{"status":"success","report":"The report has been written as a markdown file with \"CVE-2016-3088.md\""}}}],"role":"user"}

```
